; ═══════════════════════════════════════════════════════════════
; Qwen3 Voice Agent — Supervisor 配置
; 
; 安装: cp supervisor_voice_agent.conf /etc/supervisor/conf.d/
; 启动: supervisorctl reread && supervisorctl update
; 状态: supervisorctl status
; ═══════════════════════════════════════════════════════════════

; ── Token Server (前端 + Token API) ──────────────────────────
[program:token-server]
command=python3 /workspace/project 1/25/runtime/token_server.py
directory=/workspace/project 1/25/runtime
environment=
    LIVEKIT_API_KEY="API7fj35wGLumtc",
    LIVEKIT_API_SECRET="WK8k8fUhhsHoa2R2qfO076lyuDHgJubwemQuY4nk398B",
    LIVEKIT_URL="wss://renshenghehuoren-mpdsjfwe.livekit.cloud",
    TOKEN_SERVER_PORT="9090"
autostart=true
autorestart=true
startretries=10
startsecs=3
stdout_logfile=/tmp/token_server.log
stderr_logfile=/tmp/token_server_err.log
stdout_logfile_maxbytes=10MB
priority=100

; ── LiveKit Agent ────────────────────────────────────────────
[program:livekit-agent]
command=python3 /workspace/project 1/25/runtime/livekit_agent.py start
directory=/workspace/project 1/25
environment=
    LIVEKIT_URL="wss://renshenghehuoren-mpdsjfwe.livekit.cloud",
    LIVEKIT_API_KEY="API7fj35wGLumtc",
    LIVEKIT_API_SECRET="WK8k8fUhhsHoa2R2qfO076lyuDHgJubwemQuY4nk398B",
    PYTHONPATH="/workspace/vllm-omni"
autostart=true
autorestart=true
startretries=10
startsecs=5
stdout_logfile=/tmp/livekit_agent.log
stderr_logfile=/tmp/livekit_agent_err.log
stdout_logfile_maxbytes=10MB
priority=200

; ── TTS Server ───────────────────────────────────────────────
[program:tts-server]
command=bash /workspace/project 1/25/scripts/run_tts_server.sh
directory=/workspace/project 1/25/clients
environment=
    TTS_DEEP_STREAM_ENABLE="1",
    TTS_DEEP_STREAM_PROCESS="0",
    TTS_DEEP_STREAM_DECODE_MODE="incremental",
    TTS_DEEP_STREAM_PACKET_TOKENS="2",
    TTS_DEEP_STREAM_LEFT_CONTEXT="72",
    TTS_DEEP_STREAM_DETERMINISTIC="1",
    TTS_DEEP_STREAM_DETERMINISTIC_POLICY="greedy",
    TTS_DEEP_STREAM_SEED_MODE="fixed",
    TTS_DEEP_STREAM_SEED="42",
    TTS_DEEP_STREAM_DEVICE="cuda:0",
    TTS_DEEP_STREAM_CODEGEN_DEVICE="cuda:0",
    TTS_DEEP_STREAM_MODEL_DIR="/workspace/models/Qwen3-TTS-12Hz-0.6B-CustomVoice",
    TTS_CODEGEN_GROUP_PARALLEL="0",
    TTS_DEEP_STREAM_SILENCE_PACKETS="0",
    TTS_DEEP_STREAM_SILENCE_PACKETS_P1="0",
    TTS_DEEP_STREAM_OFFLINE_FROM_CODES="1",
    TTS_CODEGEN_CUDAGRAPH_CP="1",
    TTS_DECODER_CUDAGRAPH="0",
    PYTHONPATH="/workspace/vllm-omni"
autostart=true
autorestart=true
startretries=5
startsecs=20
stdout_logfile=/tmp/tts_server.log
stderr_logfile=/tmp/tts_server_err.log
stdout_logfile_maxbytes=10MB
priority=50

; ── LLM Server (vLLM-Omni) ──────────────────────────────────
[program:llm-server]
command=bash /workspace/project 1/25/scripts/run_llm_server.sh
directory=/workspace/project 1/25
environment=PYTHONPATH="/workspace/vllm-omni"
autostart=true
autorestart=true
startretries=3
startsecs=30
stdout_logfile=/tmp/llm_server.log
stderr_logfile=/tmp/llm_server_err.log
stdout_logfile_maxbytes=10MB
priority=10

; ── 服务组 ───────────────────────────────────────────────────
[group:voice-agent]
programs=llm-server,tts-server,livekit-agent,token-server
priority=100

